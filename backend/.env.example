# =============================================================================
# CMS Backend - Environment Template
# =============================================================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env
# =============================================================================

# --- Core Configuration ---
NODE_ENV=development
PORT=8000

# --- Database Configuration (PostgreSQL) ---
# Local: postgresql://postgres:postgres123@localhost:5432/cms_db?schema=public
# Docker: postgresql://postgres:postgres123@postgres:5432/cms_db?schema=public
DATABASE_URL=postgresql://postgres:postgres123@localhost:5432/cms_db?schema=public

# --- Cache Configuration (DragonflyDB/Redis) ---
# DragonflyDB running on Docker (no password)
#
# IMPORTANT: If running DragonflyDB standalone, use this command:
# docker run -d --name dragonfly -p 6379:6379 docker.dragonflydb.io/dragonflydb/dragonfly --default_lua_flags=allow-undeclared-keys
#
REDIS_URL=redis://localhost:6379
REDIS_HOST=localhost
REDIS_PORT=6379
# REDIS_PASSWORD=  # Uncomment if password is required

# --- MinIO (S3-compatible Storage) ---
# Local: http://localhost:9000
# Docker: http://minio:9000
MINIO_ENDPOINT=http://localhost:9000
MINIO_BUCKET=cms-uploads
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=YOUR_MINIO_SECRET
MINIO_REGION=us-east-1
AWS_S3_ENDPOINT=http://localhost:9000
AWS_S3_BUCKET=cms-uploads
AWS_REGION=us-east-1

# --- JWT Configuration ---
JWT_SECRET=YOUR_JWT_SECRET_MIN_32_CHARS
JWT_EXPIRATION=30m
JWT_REFRESH_EXPIRATION=7d

# --- CORS Configuration ---
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000
FRONTEND_URL=http://localhost:5173
CORS_ORIGIN=http://localhost:5173

# --- Rate Limiting (HTTP) ---
# Enable/disable HTTP throttling globally (true/false)
THROTTLE_ENABLED=true

# Default throttle settings (fallback for non-decorated routes)
THROTTLE_DEFAULT_LIMIT=100
THROTTLE_DEFAULT_TTL=60000

# Preset limits by operation type (all use default TTL unless specified)
THROTTLE_DASHBOARD_LIMIT=5
THROTTLE_EXPORT_LIMIT=3
THROTTLE_LIST_LIMIT=30
THROTTLE_MUTATION_LIMIT=10
THROTTLE_LIGHTWEIGHT_LIMIT=60

# Optional: Override TTL per preset (in milliseconds)
# THROTTLE_DASHBOARD_TTL=60000
# THROTTLE_EXPORT_TTL=60000
# THROTTLE_LIST_TTL=60000
# THROTTLE_MUTATION_TTL=60000
# THROTTLE_LIGHTWEIGHT_TTL=60000

# Skip patterns (comma-separated routes to skip throttling)
THROTTLE_SKIP_PATTERNS=/health,/api/docs,/api/docs/*

# Custom error message ({retryAfter} will be replaced with seconds)
THROTTLE_ERROR_MESSAGE=Too many requests. Please try again in {retryAfter} seconds.

# --- Rate Limiting (WebSocket) ---
# Enable/disable WebSocket rate limiting (true/false)
WS_RATE_LIMIT_ENABLED=true
WS_RATE_LIMIT_WINDOW_MS=60000
WS_RATE_LIMIT_MAX_EVENTS=100
WS_RATE_LIMIT_CLEANUP_INTERVAL_MS=300000
WS_RATE_LIMIT_ENTRY_TTL_MS=120000

# --- Security Settings ---
# Blocked user agents (comma-separated, defaults to common attack tools)
BLOCKED_USER_AGENTS=sqlmap,nikto,nmap,masscan,zgrab,gobuster,dirbuster

# Enable/disable security middleware checks
SECURITY_MIDDLEWARE_ENABLED=true

# Cookie security settings
COOKIE_SECURE=true
COOKIE_SAME_SITE=strict
COOKIE_HTTP_ONLY=true

# --- Account Lockout Settings ---
# Maximum failed login attempts before account is locked
LOCKOUT_MAX_ATTEMPTS=5
# Duration in minutes the account stays locked
LOCKOUT_DURATION_MINUTES=15
# Reset failed attempts counter after this many minutes of no failed attempts
LOCKOUT_RESET_AFTER_MINUTES=30

# --- MFA/2FA Settings (Optional) ---
# App name shown in authenticator apps
MFA_APP_NAME=CMS Portal

# --- Password Policy Settings ---
# Number of previous passwords to prevent reuse (default: 5)
PASSWORD_HISTORY_COUNT=5
# Password expiry in days (0 = no expiry, default: 90)
PASSWORD_EXPIRY_DAYS=90
# Minimum password length (default: 12)
PASSWORD_MIN_LENGTH=12
# Require complexity (uppercase, lowercase, number, special char)
PASSWORD_REQUIRE_COMPLEXITY=true

# --- Field-Level Encryption (PII Protection) ---
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=

# --- Audit Log Retention ---
# Days to retain audit logs (default: 180 per CERT-In guidelines)
AUDIT_LOG_RETENTION_DAYS=180
# Enable automatic cleanup
AUDIT_RETENTION_ENABLED=true

# --- Logging ---
LOG_LEVEL=debug

# --- File Uploads ---
MAX_FILE_SIZE=10485760
UPLOAD_DEST=./uploads

# --- Multi-tenant ---
DEFAULT_INSTITUTION_ID=main_campus

# --- Portal URL ---
PORTAL_URL=http://localhost:5173

# --- Email Configuration (Optional) ---
MAIL_USER=your-email@gmail.com
MAIL_PASS=your-app-password

# --- Google OAuth (Optional) ---
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:8000/api/auth/google/redirect
