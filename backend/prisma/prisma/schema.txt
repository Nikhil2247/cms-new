// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

// Models

model User {
    id                 String                  @id @default(auto()) @map("_id") @db.ObjectId
    email              String                  @unique
    password           String
    name               String
    role               Role?
    active             Boolean                 @default(true)
    createdAt          DateTime                @default(now())
    Student            Student?
    ClassAssignment    ClassAssignment[]
    Institution        Institution?            @relation(fields: [institutionId], references: [id])
    institutionId      String?                 @db.ObjectId
    // New internship relations
    Industry           Industry?
    menteeApplications InternshipApplication[] @relation("StudentMentor")
    mentorAssignments  MentorAssignment[]      @relation("AssignedMentor")
    assignedBy         MentorAssignment[]  @relation("AssignedBy")
    facultyVisitLogs   FacultyVisitLog[]       @relation("FacultyVisits")
    industryRequests   IndustryRequest[]       @relation("RequestSender")
    auditLogs          AuditLog[]              @relation("AuditUser")
    notifications      Notification[]          @relation("NotificationUser")

}

enum Role {
    PRINCIPAL
    ACCOUNTANT
    ADMISSION_OFFICER
    EXAMINATION_OFFICER
    TEACHER
    PLACEMENT_OFFICER
    PMS_OFFICER
    EXTRACURRICULAR_HEAD
    STUDENT
    // New roles for internship portal
    INDUSTRY
    STATE_DIRECTORATE
    FACULTY_SUPERVISOR
    SYSTEM_ADMIN
}

// Student Information linked with admissiontype, category, batch, fees, results, documents, and scholarship

model Student {
    id                     String                  @id @default(auto()) @map("_id") @db.ObjectId
    profileImage           String?
    userId                 String                  @unique @db.ObjectId
    user                   User                    @relation(fields: [userId], references: [id])
    rollNumber             String?                 @unique
    branchId               String?                 @db.ObjectId
    branch                 Branch?                 @relation(fields: [branchId], references: [id])
    branchName             String? // Cached for quick access
    admissionNumber        String?                 @unique
    name                   String
    email                  String
    contact                String?
    address                String?
    pinCode                String?
    tehsil                 String?
    district               String?
    city                   String?
    dob                    String?
    state                  String?
    parentName             String?
    parentContact          String?
    motherName             String?
    gender                 String?
    currentYear            Int?
    currentSemester        Int?
    currentSemesterMarks   Float?
    tenthper               Float?
    twelthper              Float?
    diplomaPercentage      Float?
    totalBacklogs          Int?                    @default(0)
    clearanceStatus        ClearanceStatus         @default(PENDING)
    // Preferences
    internshipPreferences  InternshipPreference?
    batchId                String?                 @db.ObjectId
    batch                  Batch?                  @relation(fields: [batchId], references: [id])
    admissionType          AdmissionType?
    category               Category?
    document               Document[]
    fees                   Fee[]
    results                ExamResult[]
    scholarshipId          String?                 @db.ObjectId
    scholarship            Scholarship?            @relation(fields: [scholarshipId], references: [id])
    feeStuctureId          String?                 @db.ObjectId
    feeStrucutre           FeeStructure?           @relation(fields: [feeStuctureId], references: [id])
    institutionId          String?                 @db.ObjectId
    Institution            Institution?            @relation(fields: [institutionId], references: [id])
    createdAt              DateTime                @default(now())
    placements             Placement[]
    internshipApplications InternshipApplication[]
    mentorAssignments      MentorAssignment[]
    complianceRecords      ComplianceRecord[]
}

model InternshipPreference {
    id        String  @id @default(auto()) @map("_id") @db.ObjectId
    studentId String  @unique @db.ObjectId
    student   Student @relation(fields: [studentId], references: [id])

    preferredFields        String[] // Array of preferred industry fields
    preferredLocations     String[] // Array of preferred work locations
    preferredDurations     String[] // e.g., ["8 weeks", "12 weeks", "26 weeks"]
    minimumStipend         Float?
    isRemotePreferred      Boolean  @default(false)
    additionalRequirements String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("internship_preferences")
}

enum ClearanceStatus {
    PENDING
    CLEARED
    HOLD
    REJECTED
}

enum AdmissionType {
    FIRST_YEAR
    LEET
}

enum Category {
    GENERAL
    OBC
    ST
    SC
}

// Batch Management (Simplified)
model Batch {
    id               String            @id @default(auto()) @map("_id") @db.ObjectId
    name             String            @unique // e.g., "2023-26"
    isActive         Boolean           @default(true)
    students         Student[]
    classAssignments ClassAssignment[]
    createdAt        DateTime          @default(now())
    Institution      Institution?      @relation(fields: [institutionId], references: [id])
    institutionId    String?           @db.ObjectId
}

// Document Management (Simplified)
model Document {
    id        String       @id @default(auto()) @map("_id") @db.ObjectId
    studentId String       @db.ObjectId
    type      DocumentType
    fileName  String
    fileUrl   String
    createdAt DateTime     @default(now())
    Student   Student      @relation(fields: [studentId], references: [id])
}

enum DocumentType {
    MARKSHEET_10TH
    MARKSHEET_12TH
    CASTE_CERTIFICATE
    PHOTO
    OTHER
}
model FeeStructure {
    id                String          @id @default(auto()) @map("_id") @db.ObjectId
    admissionType     AdmissionType // FIRST_YEAR or LEET
    scholarshipScheme ScholarshipType
    semesterNumber    Int // 1-6
    df                Float // Development Fee
    sf                Float // Student Fee
    security          Float // Security Deposit
    tf                Float // Tuition Fee
    total             String // Total Fee
    isActive          Boolean         @default(true)
    createdAt         DateTime        @default(now())
    fees              Fee[]
    students          Student[]
    Institution       Institution?    @relation(fields: [institutionId], references: [id])
    institutionId     String?         @db.ObjectId

    // Unique constraint to prevent duplicates
    @@unique([admissionType, scholarshipScheme, semesterNumber])
}

// Fee Management (Simplified)

model Fee {
    id             String        @id @default(auto()) @map("_id") @db.ObjectId
    studentId      String        @db.ObjectId
    semesterId     String        @db.ObjectId
    feeStructureId String?       @db.ObjectId
    amountDue      Float
    amountPaid     Float         @default(0)
    dueDate        DateTime
    status         FeeStatus
    createdAt      DateTime      @default(now())
    Student        Student       @relation(fields: [studentId], references: [id])
    Semester       Semester      @relation(fields: [semesterId], references: [id])
    FeeStructure   FeeStructure? @relation(fields: [feeStructureId], references: [id])
    Institution    Institution?  @relation(fields: [institutionId], references: [id])
    institutionId  String?       @db.ObjectId
}

enum FeeStatus {
    PAID
    PARTIAL
    PENDING
    WAIVED
}

// Authentication (Token Management)

model BlacklistedToken {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    token     String   @unique
    expiresAt DateTime
    createdAt DateTime @default(now())
}

// Scholarship (Simplified)
model Scholarship {
    id            String             @id @default(auto()) @map("_id") @db.ObjectId
    type          ScholarshipType
    amount        Float
    status        ScholarshipStatus?
    createdAt     DateTime           @default(now())
    students      Student[] // 1 scholarship has many students
    Institution   Institution?       @relation(fields: [institutionId], references: [id])
    institutionId String?            @db.ObjectId
}

enum ScholarshipType {
    CMS50
    CMS60
    CMS70
    CMS80
    CMS90
    PMS
    FWS
}

enum ScholarshipStatus {
    APPROVED
    REJECTED
    DISBURSED
}

// Examination Management (Simplified)

model Semester {
    id            String       @id @default(auto()) @map("_id") @db.ObjectId
    //name     String // e.g., "Semester 1"
    number        Int // e.g., 1, 2, 3, etc.
    results       ExamResult[]
    isActive      Boolean      @default(true)
    fees          Fee[]
    Institution   Institution? @relation(fields: [institutionId], references: [id])
    institutionId String?      @db.ObjectId
}

model Subject {
    id             String       @id @default(auto()) @map("_id") @db.ObjectId
    syllabusYear   Int
    semesterNumber String?
    branchName     String
    subjectName    String
    subjectCode    String
    maxMarks       Float
    subjectType    String
    createdAt      DateTime     @default(now())
    // ← add back‐relation so you can do subject.examResults
    examResults    ExamResult[]
    Institution    Institution? @relation(fields: [institutionId], references: [id])
    institutionId  String?      @db.ObjectId
    Branch         Branch?      @relation(fields: [branchId], references: [id])
    branchId       String?      @db.ObjectId
}

model ExamResult {
    id         String   @id @default(auto()) @map("_id") @db.ObjectId
    studentId  String   @db.ObjectId
    semesterId String   @db.ObjectId
    subjectId  String   @db.ObjectId
    marks      Float
    maxMarks   Float    @default(100)
    createdAt  DateTime @default(now())
    Student    Student  @relation(fields: [studentId], references: [id])
    Semester   Semester @relation(fields: [semesterId], references: [id])
    Subject    Subject  @relation(fields: [subjectId], references: [id])
}

// Placement Management (Simplified)

model Placement {
    id          String          @id @default(auto()) @map("_id") @db.ObjectId
    studentId   String          @db.ObjectId // This is your foreign key
    student     Student         @relation(fields: [studentId], references: [id]) // Add this relation field
    companyName String
    jobRole     String
    salary      Float?
    offerDate   DateTime
    status      PlacementStatus @default(OFFERED)
    createdAt   DateTime        @default(now())
}

enum PlacementStatus {
    OFFERED
    ACCEPTED
    REJECTED
    JOINED
}

// Events Management (Simplified)

model Event {
    id            String       @id @default(auto()) @map("_id") @db.ObjectId
    title         String
    description   String
    eventType     String
    startDate     DateTime
    venue         String
    isActive      Boolean      @default(true)
    createdAt     DateTime     @default(now())
    Institution   Institution? @relation(fields: [institutionId], references: [id])
    institutionId String?      @db.ObjectId
}

model EventRegistration {
    id             String    @id @default(auto()) @map("_id") @db.ObjectId
    eventId        String    @db.ObjectId
    studentId      String    @db.ObjectId
    attended       Boolean?
    attendanceDate DateTime?
    notes          String?
    createdAt      DateTime  @default(now())
}

// Teacher Assignment (Simplified)

model ClassAssignment {
    id            String       @id @default(auto()) @map("_id") @db.ObjectId
    teacherId     String       @db.ObjectId
    batchId       String       @db.ObjectId
    section       String?
    academicYear  String?
    isActive      Boolean      @default(true)
    Batch         Batch        @relation(fields: [batchId], references: [id])
    teacher       User         @relation(fields: [teacherId], references: [id])
    Institution   Institution? @relation(fields: [institutionId], references: [id])
    institutionId String?      @db.ObjectId
}

// Institution Model
model Institution {
    id        String          @id @default(auto()) @map("_id") @db.ObjectId
    code      String          @unique // The unique code for the institution (e.g., "INST001", "MAIN_CAMPUS")
    name      String? // Optional: Full name of the institution
    shortName String?
    type      InstitutionType @default(POLYTECHNIC)

    // Contact Information
    address        String
    city           String
    state          String
    pinCode        String
    country        String  @default("India")
    contactEmail   String
    contactPhone   String
    alternatePhone String?
    website        String?

    // Administrative Details
    establishedYear  Int?
    affiliatedTo     String? // University/Board affiliation
    recognizedBy     String? // AICTE, UGC, etc.
    naacGrade        String?
    autonomousStatus Boolean @default(false)

    // Configuration
    isActive  Boolean              @default(true)
    settings  InstitutionSettings?
    // Timestamps
    createdAt DateTime             @default(now())
    updatedAt DateTime             @updatedAt

    // --- Relations to other models ---
    // Add relations for models that DIRECTLY belong to an institution
    users            User[]
    batches          Batch[]
    feeStructures    FeeStructure[]
    scholarships     Scholarship[] // Assuming scholarship definitions are per-institution
    semesters        Semester[] // Semesters belong to an institution's academic structure
    subjects         Subject[] // Subjects are defined within an institution/program
    events           Event[] // Events are typically organized by an institution
    classAssignments ClassAssignment[] // Assignments happen within an institution
    auditLogs        AuditLog[] // Audit logs should track the institution context
    calendars        Calendar[] // Calendars are institution-specific
    notices          Notice[] // Notices are issued by an institution

    // Note: Models like Student, Fee, Document, ExamResult, Placement, EventRegistration
    // will likely be linked indirectly via their parent (e.g., Student via User or directly,
    // Fee via Student, Document via Student, etc.)
    Student Student[]
    Fee     Fee[]

    // New internship relations
    industries       Industry[]
    internships      Internship[]
    industryRequests IndustryRequest[]
    notifications    Notification[]
    Branch           Branch[]
    Department       Department[]
}

model InstitutionSettings {
    id            String      @id @default(auto()) @map("_id") @db.ObjectId
    institutionId String      @unique @db.ObjectId
    institution   Institution @relation(fields: [institutionId], references: [id])

    // Academic Settings
    academicYearStart   String // Format: "YYYY-MM-DD"
    academicYearEnd     String // Format: "YYYY-MM-DD"
    currentAcademicYear String // Format: "2024-25"
    totalSemesters      Int    @default(6)

    // Internship Settings
    minInternshipDuration Int    @default(8) // weeks
    maxInternshipDuration Int    @default(26) // weeks
    mandatoryVisitsCount  Int    @default(3)
    feedbackFrequency     String @default("MONTHLY") // WEEKLY, MONTHLY, QUARTERLY

    // Notification Settings
    emailNotificationsEnabled Boolean @default(true)
    smsNotificationsEnabled   Boolean @default(false)

    // System Settings
    allowSelfRegistration Boolean @default(false)
    maintenanceMode       Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("institution_settings")
}

enum InstitutionType {
    POLYTECHNIC
    ENGINEERING_COLLEGE
    UNIVERSITY
    DEGREE_COLLEGE
    ITI
    SKILL_CENTER
}

// =============================================
// ACADEMIC STRUCTURE
// =============================================

model Branch {
    id        String  @id @default(auto()) @map("_id") @db.ObjectId
    name      String
    shortName String
    code      String  @unique
    duration  Int // Duration in years
    isActive  Boolean @default(true)

    institutionId String      @db.ObjectId
    institution   Institution @relation(fields: [institutionId], references: [id])

    students Student[]
    subjects Subject[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("branches")
}

model Department {
    id        String  @id @default(auto()) @map("_id") @db.ObjectId
    name      String
    shortName String?
    code      String  @unique
    hodId     String? @db.ObjectId // Head of Department
    isActive  Boolean @default(true)

    institutionId String      @db.ObjectId
    institution   Institution @relation(fields: [institutionId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("departments")
}

// Audit Log (Basic)

model AuditLog {
    id         String      @id @default(auto()) @map("_id") @db.ObjectId
    // Core Tracking Information
    entityType String // e.g., "Student", "Internship", "InternshipApplication", "Industry"
    entityId   String?     @db.ObjectId // ID of the affected entity
    action     AuditAction // Standardized actions

    // User Context
    userId   String  @db.ObjectId
    user     User    @relation("AuditUser", fields: [userId], references: [id])
    userRole Role // Role of the user performing the action
    userName String? // Cache user name for quick reference

    // Change Details
    oldValues     Json? // Previous state of the entity (for updates)
    newValues     Json? // New state of the entity (for creates/updates)
    changedFields String[] // Array of field names that changed

    // Context Information
    description String? // Human-readable description of the action
    category    AuditCategory // Categorize the type of operation
    severity    AuditSeverity @default(LOW) // Importance level

    timestamp     DateTime     @default(now())
    Institution   Institution? @relation(fields: [institutionId], references: [id])
    institutionId String?      @db.ObjectId
}

// =============================================
// AUDIT ENUMS
// =============================================

enum AuditAction {
    // User Management
    USER_LOGIN
    USER_LOGOUT
    USER_REGISTRATION
    USER_PROFILE_UPDATE
    PASSWORD_CHANGE
    PASSWORD_RESET
    USER_ACTIVATION
    USER_DEACTIVATION

    // Student Operations
    STUDENT_PROFILE_VIEW
    STUDENT_PROFILE_UPDATE
    STUDENT_DOCUMENT_UPLOAD
    STUDENT_DOCUMENT_DELETE

    // Internship Operations
    INTERNSHIP_CREATE
    INTERNSHIP_UPDATE
    INTERNSHIP_DELETE
    INTERNSHIP_ACTIVATE
    INTERNSHIP_DEACTIVATE
    INTERNSHIP_VIEW
    INTERNSHIP_SEARCH

    // Application Operations
    APPLICATION_SUBMIT
    APPLICATION_UPDATE
    APPLICATION_WITHDRAW
    APPLICATION_VIEW
    APPLICATION_APPROVE
    APPLICATION_REJECT
    APPLICATION_BULK_ACTION

    // Industry Operations
    INDUSTRY_REGISTER
    INDUSTRY_PROFILE_UPDATE
    INDUSTRY_APPROVAL
    INDUSTRY_REJECTION
    INDUSTRY_VIEW_APPLICANTS

    // Mentor Assignment
    MENTOR_ASSIGN
    MENTOR_UNASSIGN
    MENTOR_UPDATE

    // Feedback Operations
    MONTHLY_FEEDBACK_SUBMIT
    MONTHLY_FEEDBACK_UPDATE
    COMPLETION_FEEDBACK_SUBMIT
    FEEDBACK_VIEW

    // Faculty Operations
    VISIT_LOG_CREATE
    VISIT_LOG_UPDATE
    VISIT_LOG_VIEW
    FACULTY_ASSIGNMENT

    // Administrative Operations
    REPORT_GENERATE
    REPORT_DOWNLOAD
    REPORT_VIEW
    BULK_OPERATION
    DATA_EXPORT
    DATA_IMPORT

    // System Operations
    SYSTEM_BACKUP
    SYSTEM_RESTORE
    CONFIGURATION_CHANGE
    PERMISSION_CHANGE

    // Security Events
    UNAUTHORIZED_ACCESS
    FAILED_LOGIN
    SUSPICIOUS_ACTIVITY
    DATA_BREACH_ATTEMPT

    // Compliance Operations
    COMPLIANCE_CHECK
    AUDIT_TRAIL_ACCESS
    PRIVACY_POLICY_UPDATE
    CONSENT_GIVEN
    CONSENT_WITHDRAWN
}

enum AuditCategory {
    AUTHENTICATION // Login, logout, password changes
    PROFILE_MANAGEMENT // Profile updates, document uploads
    INTERNSHIP_WORKFLOW // Internship-related operations
    APPLICATION_PROCESS // Application submissions, approvals
    FEEDBACK_SYSTEM // All feedback operations
    ADMINISTRATIVE // Admin operations, reports
    SECURITY // Security-related events
    COMPLIANCE // Compliance and audit operations
    SYSTEM // System-level operations
    DATA_MANAGEMENT // Data operations, exports, imports
}

enum AuditSeverity {
    LOW // Regular operations, views
    MEDIUM // Updates, submissions
    HIGH // Approvals, rejections, assignments
    CRITICAL // Security events, system changes, compliance
}

model Calendar {
    id            String       @id @default(auto()) @map("_id") @db.ObjectId
    title         String
    startDate     DateTime?
    endDate       DateTime?
    createdAt     DateTime     @default(now())
    updatedAt     DateTime     @updatedAt
    Institution   Institution? @relation(fields: [institutionId], references: [id])
    institutionId String?      @db.ObjectId
}

model Notice {
    id            String       @id @default(auto()) @map("_id") @db.ObjectId
    title         String
    message       String
    createdAt     DateTime     @default(now())
    updatedAt     DateTime     @updatedAt
    Institution   Institution? @relation(fields: [institutionId], references: [id])
    institutionId String?      @db.ObjectId
}

// =============================================
// MENTOR & COMPLIANCE MANAGEMENT
// =============================================

model MentorAssignment {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Relations
    studentId String  @db.ObjectId
    student   Student @relation(fields: [studentId], references: [id])
    mentorId  String  @db.ObjectId
    mentor    User    @relation("AssignedMentor", fields: [mentorId], references: [id])

    // Assignment tracking
    assignedBy       String   @db.ObjectId
    assignedByUser   User     @relation("AssignedBy", fields: [assignedBy], references: [id])
    assignmentDate   DateTime @default(now())
    assignmentReason String?

    // Status
    isActive           Boolean   @default(true)
    deactivatedAt      DateTime?
    deactivatedBy      String?   @db.ObjectId
    deactivationReason String?

    // Context
    academicYear        String
    semester            String?
    specialInstructions String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    userId    String?  @db.ObjectId

    @@unique([studentId, isActive]) // Only one active mentor per student
    @@map("mentor_assignments")
}

model ComplianceRecord {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Relations
    studentId String  @db.ObjectId
    student   Student @relation(fields: [studentId], references: [id])

    // Compliance tracking
    complianceType ComplianceType
    status         ComplianceStatus @default(PENDING_REVIEW)

    // Visit compliance
    requiredVisits  Int?      @default(0)
    completedVisits Int?      @default(0)
    lastVisitDate   DateTime?
    nextVisitDue    DateTime?

    // Feedback compliance  
    requiredFeedbacks  Int?      @default(0)
    completedFeedbacks Int?      @default(0)
    lastFeedbackDate   DateTime?
    nextFeedbackDue    DateTime?

    // Overall metrics
    complianceScore Float? // Percentage score
    complianceGrade ComplianceGrade?
    remarks         String?
    actionRequired  String?

    // Review tracking
    reviewedBy     String?   @db.ObjectId
    reviewedAt     DateTime?
    nextReviewDate DateTime?

    // Context
    academicYear String
    semester     String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("compliance_records")
}

// =============================================
// INTERNSHIP PORTAL MODELS
// =============================================

// Industry/Company Profile
model Industry {
    id     String @id @default(auto()) @map("_id") @db.ObjectId
    userId String @unique @db.ObjectId
    user   User   @relation(fields: [userId], references: [id])

    // Company Information
    companyName        String
    companyDescription String?
    industryType       IndustryType
    establishedYear    Int?
    companySize        CompanySize
    employeeCount      Int?

    // Contact Information
    contactPersonName  String
    contactPersonTitle String
    primaryEmail       String
    alternateEmail     String?
    primaryPhone       String
    alternatePhone     String?
    website            String?

    // Address Information
    address String
    city    String
    state   String
    pinCode String
    country String @default("India")

    // Legal Information
    registrationNumber String
    panNumber          String
    gstNumber          String?

    // Approval Status
    isVerified Boolean   @default(false)
    verifiedAt DateTime?
    verifiedBy String?   @db.ObjectId
    isApproved Boolean   @default(false)
    approvedAt DateTime?
    approvedBy String?   @db.ObjectId

    // Relations
    internships         Internship[]
    monthlyFeedbacks    MonthlyFeedback[]
    completionFeedbacks CompletionFeedback[]
    industryRequests    IndustryRequest[]
    // Institution context
    institutionId       String?              @db.ObjectId
    Institution         Institution?         @relation(fields: [institutionId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("industries")
}

// Core Internship Model
model Internship {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Basic Information
    title               String
    description         String
    detailedDescription String?
    fieldOfWork         String

    // Position Details
    numberOfPositions   Int
    duration            String // e.g., "3 months", "6 months"
    startDate           DateTime?
    endDate             DateTime?
    applicationDeadline DateTime

    // Location Information
    workLocation    String
    isRemoteAllowed Boolean @default(false)

    // Eligibility Criteria
    eligibleBranches  String[] // Can apply to multiple branches
    minimumPercentage Float?
    eligibleSemesters String[] // e.g., ["5", "6"]

    // Stipend Information
    isStipendProvided Boolean @default(false)
    stipendAmount     Float?
    stipendDetails    String?

    // Requirements
    requiredSkills  String[]
    preferredSkills String[]

    // Status
    status   InternshipStatus @default(ACTIVE)
    isActive Boolean          @default(true)

    // Relations
    industryId String   @db.ObjectId
    industry   Industry @relation(fields: [industryId], references: [id])

    applications     InternshipApplication[]
    monthlyFeedbacks MonthlyFeedback[]
    facultyVisitLogs FacultyVisitLog[]

    // Institution context
    institutionId String?      @db.ObjectId
    Institution   Institution? @relation(fields: [institutionId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("internships")
}

// Student Internship Application
model InternshipApplication {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Relations
    studentId String  @db.ObjectId
    student   Student @relation(fields: [studentId], references: [id])

    internshipId String     @db.ObjectId
    internship   Internship @relation(fields: [internshipId], references: [id])

    // Application Details
    applicationDate DateTime @default(now())
    coverLetter     String?
    resume          String?
    additionalInfo  String?

    // Selection Status
    status       ApplicationStatus @default(APPLIED)
    appliedDate  DateTime          @default(now())
    reviewedDate DateTime?

    // Industry Decision
    isSelected      Boolean   @default(false)
    selectionDate   DateTime?
    rejectionReason String?

    // Joining Information
    hasJoined      Boolean   @default(false)
    joiningDate    DateTime?
    completionDate DateTime?

    // Mentor Assignment
    mentorId         String?   @db.ObjectId
    mentor           User?     @relation("StudentMentor", fields: [mentorId], references: [id])
    mentorAssignedAt DateTime?
    mentorAssignedBy String?   @db.ObjectId // Principal/Admin who assigned

    // Relations to feedback
    monthlyFeedbacks   MonthlyFeedback[]
    completionFeedback CompletionFeedback?
    facultyVisitLogs   FacultyVisitLog[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([studentId, internshipId])
    @@map("internship_applications")
}

// Monthly Feedback from Industry
model MonthlyFeedback {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Relations
    applicationId String                @db.ObjectId
    application   InternshipApplication @relation(fields: [applicationId], references: [id])

    industryId String   @db.ObjectId
    industry   Industry @relation(fields: [industryId], references: [id])

    internshipId String     @db.ObjectId
    internship   Internship @relation(fields: [internshipId], references: [id])

    // Feedback Details
    feedbackMonth         DateTime // Which month this feedback is for
    attendanceRating      Int? // 1-5 scale
    performanceRating     Int? // 1-5 scale
    punctualityRating     Int? // 1-5 scale
    technicalSkillsRating Int? // 1-5 scale

    // Detailed Feedback
    strengths           String?
    areasForImprovement String?
    tasksAssigned       String?
    tasksCompleted      String?
    overallComments     String?

    // Ratings
    overallRating Int? // 1-5 scale

    // Submission Details
    submittedAt DateTime @default(now())
    submittedBy String   @db.ObjectId // Industry user who submitted

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("monthly_feedbacks")
}

// Completion Feedback (from both Student and Industry)
model CompletionFeedback {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Relations
    applicationId String                @unique @db.ObjectId
    application   InternshipApplication @relation(fields: [applicationId], references: [id])

    // Feedback from Student
    studentFeedback    String?
    studentRating      Int? // 1-5 scale for internship experience
    skillsLearned      String?
    careerImpact       String?
    wouldRecommend     Boolean?
    studentSubmittedAt DateTime?

    // Feedback from Industry
    industryFeedback    String?
    industryRating      Int? // 1-5 scale for student performance
    finalPerformance    String?
    recommendForHire    Boolean?
    industrySubmittedAt DateTime?

    // Overall Assessment
    isCompleted           Boolean @default(false)
    completionCertificate String? // File path if certificate provided

    createdAt  DateTime  @default(now())
    updatedAt  DateTime  @updatedAt
    Industry   Industry? @relation(fields: [industryId], references: [id])
    industryId String?   @db.ObjectId

    @@map("completion_feedbacks")
}

// Faculty Visit Log
model FacultyVisitLog {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Relations
    applicationId String                @db.ObjectId
    application   InternshipApplication @relation(fields: [applicationId], references: [id])

    internshipId String     @db.ObjectId
    internship   Internship @relation(fields: [internshipId], references: [id])

    facultyId String @db.ObjectId
    faculty   User   @relation("FacultyVisits", fields: [facultyId], references: [id])

    // Visit Details
    visitNumber   Int?
    visitDate     DateTime
    visitDuration String? // e.g., "2 hours"
    visitType     VisitType @default(PHYSICAL)

    // Observations
    studentPerformance String?
    workEnvironment    String?
    industrySupport    String?
    skillsDevelopment  String?
    attendanceStatus   String?
    workQuality        String?

    // Ratings (1-5 scale)
    studentProgressRating     Int?
    industryCooperationRating Int?
    workEnvironmentRating     Int?
    mentoringSupportRating    Int?
    overallSatisfactionRating Int?

    // Issues and Recommendations
    issuesIdentified String?
    recommendations  String?
    actionRequired   String?

    // Documentation
    visitPhotos    String[] // URLs to photos taken during visit
    meetingMinutes String?
    attendeesList  String[] // Names of people met during visit

    // Administrative
    reportSubmittedTo String?   @db.ObjectId // Principal/Admin
    followUpRequired  Boolean   @default(false)
    nextVisitDate     DateTime?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("faculty_visit_logs")
}

// State Directorate Analytics/Reports
model StateReport {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    reportType        ReportType
    reportCategory    StateReportCategory?
    reportPeriod      String // e.g., "Q1 2024", "Annual 2024"
    reportTitle       String?
    reportDescription String?

    // Coverage
    institutionIds    String[] // Institutions covered in report
    fromDate          DateTime?
    toDate            DateTime?
    // Aggregated Data
    totalInternships  Int
    totalApplications Int
    totalPlacements   Int
    institutionCount  Int
    industryCount     Int
    totalStudents     Int?
    totalFaculty      Int?

    // Performance metrics
    applicationToPlacementRatio Float?
    placementRate               Float? // Percentage
    completionRate              Float? // Percentage  
    industryParticipationRate   Float? // Percentage
    averageStipend              Float?
    medianStipend               Float?

    // Analytics
    branchWiseData      Json? // Branch-wise statistics
    institutionWiseData Json? // Institution-wise statistics
    performanceMetrics  Json? // Various KPIs
    industryWiseData    Json? // Industry participation data
    geographicData      Json? // District/city-wise data
    trendData           Json?
    complianceData      Json? // Detailed compliance analysis            // Historical trends
    // File References
    reportFileUrl       String?
    generatedAt         DateTime @default(now())
    generatedBy         String   @db.ObjectId

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("state_reports")
}

// =============================================
// COMMUNICATION & REQUESTS
// =============================================

model IndustryRequest {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Request details
    requestType     IndustryRequestType
    priority        RequestPriority     @default(MEDIUM)
    title           String
    description     String
    requirements    String?
    expectedOutcome String?

    // Target industry
    industryId String?   @db.ObjectId
    industry   Industry? @relation(fields: [industryId], references: [id])

    // Industry criteria (if no specific industry targeted)
    targetIndustryType   IndustryType?
    preferredLocation    String?
    preferredCompanySize CompanySize?

    // Request context
    requestedBy     String      @db.ObjectId
    requestedByUser User        @relation("RequestSender", fields: [requestedBy], references: [id])
    institutionId   String      @db.ObjectId
    institution     Institution @relation(fields: [institutionId], references: [id])

    // Timeline
    requestDeadline    DateTime?
    expectedResponseBy DateTime?

    // Status tracking
    status              RequestStatus @default(SENT)
    statusHistory       Json[] // Track status changes
    responseMessage     String?
    respondedAt         DateTime?
    responseAttachments String[] // URLs to response documents

    // Internal processing
    assignedTo       String? @db.ObjectId // Staff member handling this request
    internalNotes    String?
    followUpRequired Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("industry_requests")
}

model Notification {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // Notification content
    title            String
    message          String
    notificationType NotificationType
    priority         NotificationPriority @default(NORMAL)

    // Target audience
    recipientId   String?      @db.ObjectId
    recipient     User?        @relation("NotificationUser", fields: [recipientId], references: [id])
    recipientRole Role? // For role-based notifications
    institutionId String?      @db.ObjectId
    institution   Institution? @relation(fields: [institutionId], references: [id])

    // Related entity
    entityType String? // "Internship", "Application", etc.
    entityId   String? @db.ObjectId

    // Delivery settings
    isEmailSent Boolean   @default(false)
    emailSentAt DateTime?
    isSMSSent   Boolean   @default(false)
    smsSentAt   DateTime?
    isPushSent  Boolean   @default(false)
    pushSentAt  DateTime?

    // Status
    isRead     Boolean   @default(false)
    readAt     DateTime?
    isArchived Boolean   @default(false)
    archivedAt DateTime?

    // Scheduling
    scheduledFor DateTime? // For scheduled notifications
    expiresAt    DateTime? // When notification becomes irrelevant

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("notifications")
}

// =============================================
// ENUMS FOR INTERNSHIP PORTAL
// =============================================

enum IndustryType {
    INFORMATION_TECHNOLOGY
    SOFTWARE_DEVELOPMENT
    MANUFACTURING
    AUTOMOTIVE
    ELECTRONICS
    TELECOMMUNICATIONS
    CONSTRUCTION
    CIVIL_ENGINEERING
    MECHANICAL_ENGINEERING
    ELECTRICAL_ENGINEERING
    ENERGY_UTILITIES
    HEALTHCARE
    PHARMACEUTICALS
    FINANCE_BANKING
    EDUCATION
    RESEARCH_DEVELOPMENT
    GOVERNMENT
    STARTUP
    CONSULTING
    MEDIA_ADVERTISING
    RETAIL
    HOSPITALITY
    LOGISTICS_SUPPLY_CHAIN
    AGRICULTURE
    TEXTILES
    CHEMICALS
    AEROSPACE
    DEFENSE
    OTHER
}

enum CompanySize {
    STARTUP // 1-10 employees
    SMALL // 11-50 employees
    MEDIUM // 51-200 employees
    LARGE // 201-1000 employees
    ENTERPRISE // 1000+ employees
}

enum InternshipStatus {
    ACTIVE
    INACTIVE
    COMPLETED
    CANCELLED
}

enum ApplicationStatus {
    APPLIED
    UNDER_REVIEW
    SHORTLISTED
    SELECTED
    REJECTED
    JOINED
    COMPLETED
    WITHDRAWN
}

enum VisitType {
    PHYSICAL
    VIRTUAL
    TELEPHONIC
}

enum ReportType {
    MONTHLY
    QUARTERLY
    ANNUAL
    CUSTOM
}

enum IndustryRequestType {
    INTERNSHIP_PARTNERSHIP
    BULK_INTERNSHIP_REQUEST
    GUEST_LECTURE
    INDUSTRY_VISIT
    PLACEMENT_DRIVE
    SKILL_DEVELOPMENT_PROGRAM
    CURRICULUM_COLLABORATION
    RESEARCH_COLLABORATION
    EQUIPMENT_DONATION
    SCHOLARSHIP_SPONSORSHIP
    FACULTY_TRAINING
    STUDENT_MENTORSHIP
    PROJECT_COLLABORATION
    OTHER
}

enum ComplianceType {
    FACULTY_VISIT
    MONTHLY_FEEDBACK
    COMPLETION_FEEDBACK
    DOCUMENTATION
    ATTENDANCE
    OVERALL_INTERNSHIP
}

enum ComplianceStatus {
    COMPLIANT
    NON_COMPLIANT
    PARTIALLY_COMPLIANT
    PENDING_REVIEW
    OVERDUE
    EXEMPTED
}

enum ComplianceGrade {
    EXCELLENT // 90-100%
    GOOD // 75-89%
    AVERAGE // 60-74%
    POOR // 40-59%
    CRITICAL // Below 40%
}

enum NotificationType {
    APPLICATION_STATUS
    INTERNSHIP_UPDATE
    FEEDBACK_REQUEST
    VISIT_REMINDER
    DEADLINE_REMINDER
    COMPLIANCE_ALERT
    SYSTEM_ANNOUNCEMENT
    MENTOR_ASSIGNMENT
    INDUSTRY_REQUEST
    APPROVAL_REQUEST
    GENERAL
}

enum NotificationPriority {
    LOW
    NORMAL
    HIGH
    URGENT
}

enum RequestStatus {
    DRAFT
    SENT
    DELIVERED
    ACKNOWLEDGED
    UNDER_REVIEW
    IN_PROGRESS
    ACCEPTED
    PARTIALLY_ACCEPTED
    REJECTED
    EXPIRED
    CANCELLED
    COMPLETED
}

enum RequestPriority {
    LOW
    MEDIUM
    HIGH
    URGENT
}

enum StateReportCategory {
    EXECUTIVE_SUMMARY
    PERFORMANCE_ANALYTICS
    COMPLIANCE_REPORT
    INDUSTRY_ENGAGEMENT
    STUDENT_PLACEMENT_ANALYSIS
    INSTITUTIONAL_COMPARISON
    TREND_ANALYSIS
    QUALITY_METRICS
    FEEDBACK_ANALYSIS
    GEOGRAPHIC_ANALYSIS
    MONTHLY_SUMMARY
    ANNUAL_REVIEW
}
